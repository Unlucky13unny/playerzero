// Archived version: OCR using fixed crop zones

const Tesseract = window.Tesseract;

function processImage(imageFile, isStart = true) {
  const reader = new FileReader();
  reader.onload = function () {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      const width = img.width;
      const height = img.height;
      canvas.width = width;
      canvas.height = height;
      ctx.drawImage(img, 0, 0);

      // Define crop box near expected location (old method)
      const cropX = Math.floor(width * 0.26);
      const cropY = Math.floor(height * 0.52);
      const cropWidth = Math.floor(width * 0.46);
      const cropHeight = Math.floor(height * 0.07);

      const imageData = ctx.getImageData(cropX, cropY, cropWidth, cropHeight);
      const croppedCanvas = document.createElement("canvas");
      croppedCanvas.width = cropWidth;
      croppedCanvas.height = cropHeight;
      const croppedCtx = croppedCanvas.getContext("2d");
      croppedCtx.putImageData(imageData, 0, 0);

      Tesseract.recognize(croppedCanvas, 'eng', {
        tessedit_char_whitelist: '0123456789',
        logger: m => console.log(m)
      }).then(({ data: { text } }) => {
        const numbers = text.match(/\d+/g);
        if (numbers && numbers.length >= 2) {
          if (isStart) {
            document.getElementById("startSeen").value = numbers[0];
            document.getElementById("startCaught").value = numbers[1];
          } else {
            document.getElementById("endSeen").value = numbers[0];
            document.getElementById("endCaught").value = numbers[1];
          }
        } else {
          showMessage(`⚠️ Couldn't extract numbers. Try a different screenshot or enter manually.`, true);
        }
      });
    };
    img.src = reader.result;
    document.getElementById("screenshotPreview").src = reader.result;
    document.getElementById("screenshotPreview").style.display = "block";
  };
  reader.readAsDataURL(imageFile);
}
