<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comm Day Calculator | PlayerZero</title>
  <link rel="icon" href="/favicon.png" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #fff;
      color: #111;
      padding: 2rem;
      margin: 0;
      text-align: center;
    }
    input, button {
      padding: 0.5rem;
      width: 100%;
      max-width: 400px;
      margin: 0.5rem auto;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #111;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    .logo {
      max-width: 280px;
      height: auto;
      margin: 1rem auto;
    }
    #card {
      display: none;
      width: 100%;
      max-width: 420px;
      background: url('card-bg-image.png') center/cover no-repeat #fff;
      border: 4px solid #000;
      border-radius: 30px;
      margin: 2rem auto;
      padding: 1.5rem 1rem;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.1);
    }
    .username {
      font-size: 1.1rem;
      margin: 0.25rem 0 0.75rem;
    }
    .stat-group {
      display: flex;
      justify-content: space-between;
      margin: 1rem 0;
      border-top: 1px solid #eee;
      padding-top: 1rem;
    }
    .stat {
      width: 48%;
    }
    .label {
      font-size: 0.85rem;
      text-transform: uppercase;
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #e30613;
    }
    .footer {
      background: #000;
      color: #fff;
      font-size: 1rem;
      padding: 0.75rem;
      margin-top: 1.5rem;
      margin-left: auto;
      margin-right: auto;
      border-radius: 8px;
      letter-spacing: 1px;
      width: 80%;
      max-width: 280px;
    }
    .social-icons {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    .social-icons a img {
      width: 36px;
      height: 36px;
      filter: brightness(0%);
      transition: filter 0.3s ease, transform 0.2s ease;
    }
    .social-icons a img:hover {
      filter: brightness(0%) invert(50%);
      transform: scale(1.1);
    }
    .promo-link {
      margin-top: 1rem;
      font-size: 0.9rem;
    }
    .promo-link a {
      color: red;
      font-weight: bold;
      text-decoration: none;
    }
  </style>
</head>
<body>
<a href="https://pgplayerzero.com" target="_blank">
  <img src="playerzero-logo.png" alt="PlayerZero Challenge Logo" class="logo">
</a>

<h1>Comm Day Calculator</h1>
<p>Upload your profile screenshots and weâ€™ll break down your grind.</p>

<input type="file" id="startImage" accept="image/*">
<button onclick="processImage('start')">Import START Stats</button>

<input type="file" id="endImage" accept="image/*">
<button onclick="processImage('end')">Import END Stats</button>

<input type="text" id="trainerNameInput" placeholder="Trainer Name (optional)">
<input type="number" id="hoursPlayed" placeholder="Hours Played (e.g., 3)">
<input type="number" id="shiniesCaught" placeholder="Shinies Caught">

<button onclick="generateCard()">Run My Stats</button>

<div id="card">
  <div class="footer">COMM DAY CARD</div>
  <img src="playerzero-logo.png" alt="PlayerZero Logo" class="logo">
  <div class="username" id="trainerDisplay">@Trainer</div>

  <div class="stat-group">
    <div class="stat">
      <div class="label">Total Caught</div>
      <div class="value" id="totalCaughtDisplay">0</div>
    </div>
    <div class="stat">
      <div class="label">Catch %</div>
      <div class="value" id="catchPercentDisplay">0%</div>
    </div>
  </div>

  <div class="stat-group">
    <div class="stat">
      <div class="label">Caught per Hour</div>
      <div class="value" id="caughtPerHourDisplay">0</div>
    </div>
    <div class="stat">
      <div class="label">Shinies</div>
      <div class="value" id="shiniesDisplay">0</div>
    </div>
  </div>
</div>

<button onclick="downloadCard()">Download My Comm Day Card</button>

<div class="promo-link">
  <a href="https://pgplayerzero.com" target="_blank">Check out the PlayerZero Challenge</a>
</div>

<div class="social-icons">
  <a href="https://instagram.com/pgplayerzero" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram"></a>
  <a href="https://tiktok.com/@pgplayerzero" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok"></a>
  <a href="https://www.reddit.com/r/pgPlayerZero" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/reddit.svg" alt="Reddit"></a>
</div>

<script>
const cropZones = {
  seen: { left: 270, top: 475, width: 130, height: 65 },
  caught: { left: 440, top: 475, width: 130, height: 65 }
};

let stats = {
  startSeen: 0,
  startCaught: 0,
  endSeen: 0,
  endCaught: 0
};

async function processImage(type) {
  const input = document.getElementById(type + 'Image');
  if (!input.files.length) return alert("Please upload a file.");

  const img = new Image();
  img.src = URL.createObjectURL(input.files[0]);
  await img.decode();

  const canvas = document.createElement("canvas");
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0);

  const seen = ctx.getImageData(cropZones.seen.left, cropZones.seen.top, cropZones.seen.width, cropZones.seen.height);
  const caught = ctx.getImageData(cropZones.caught.left, cropZones.caught.top, cropZones.caught.width, cropZones.caught.height);

  const seenCanvas = document.createElement("canvas");
  seenCanvas.width = cropZones.seen.width;
  seenCanvas.height = cropZones.seen.height;
  seenCanvas.getContext("2d").putImageData(seen, 0, 0);

  const caughtCanvas = document.createElement("canvas");
  caughtCanvas.width = cropZones.caught.width;
  caughtCanvas.height = cropZones.caught.height;
  caughtCanvas.getContext("2d").putImageData(caught, 0, 0);

  const seenText = await Tesseract.recognize(seenCanvas, 'eng', { tessedit_char_whitelist: '0123456789', psm: 7 });
  const caughtText = await Tesseract.recognize(caughtCanvas, 'eng', { tessedit_char_whitelist: '0123456789', psm: 7 });

  const seenVal = parseInt(seenText.data.text.replace(/\D/g, '')) || 0;
  const caughtVal = parseInt(caughtText.data.text.replace(/\D/g, '')) || 0;

  stats[type + 'Seen'] = seenVal;
  stats[type + 'Caught'] = caughtVal;

  alert(`${type.toUpperCase()} stats imported!\nSeen: ${seenVal}\nCaught: ${caughtVal}`);
}

function generateCard() {
  const hours = parseFloat(document.getElementById("hoursPlayed").value) || 1;
  const trainer = document.getElementById("trainerNameInput").value || "@Trainer";
  const shinies = parseInt(document.getElementById("shiniesCaught").value) || 0;

  const totalCaught = stats.endCaught - stats.startCaught;
  const seenDiff = stats.endSeen - stats.startSeen;
  const catchPercent = seenDiff ? ((totalCaught / seenDiff) * 100).toFixed(1) : "0.0";
  const perHour = (totalCaught / hours).toFixed(1);

  document.getElementById("trainerDisplay").innerText = trainer;
  document.getElementById("totalCaughtDisplay").innerText = totalCaught.toLocaleString();
  document.getElementById("catchPercentDisplay").innerText = `${catchPercent}%`;
  document.getElementById("caughtPerHourDisplay").innerText = perHour;
  document.getElementById("shiniesDisplay").innerText = shinies;

  document.getElementById("card").style.display = "block";
}

function downloadCard() {
  html2canvas(document.getElementById("card")).then(canvas => {
    const link = document.createElement("a");
    link.download = "comm_day_card.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
}
</script>
</body>
</html>
