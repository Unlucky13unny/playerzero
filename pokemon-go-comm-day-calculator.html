<!-- Supabase Integration -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Initialize Supabase client (replace with your project URL and anon key)
    const supabaseUrl = 'https://your-project-url.supabase.co';
    const supabaseKey = 'your-public-anon-key';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);
    
    // Image upload handling
    async function uploadScreenshots() {
        const startImage = document.getElementById('startImage').files[0];
        const endImage = document.getElementById('endImage').files[0];
        const shouldStore = document.getElementById('consentCheckbox').checked;
        
        if (!shouldStore) return null;
        
        // Generate unique ID for this submission
        const submissionId = Date.now().toString(36) + Math.random().toString(36).substr(2);
        
        try {
            // Upload start screenshot if available
            if (startImage) {
                await supabase.storage
                    .from('commday-screenshots')
                    .upload(`${submissionId}_start.jpg`, startImage);
            }
            
            // Upload end screenshot if available
            if (endImage) {
                await supabase.storage
                    .from('commday-screenshots')
                    .upload(`${submissionId}_end.jpg`, endImage);
            }
            
            return submissionId;
        } catch (error) {
            console.error('Error uploading screenshots:', error);
            return null;
        }
    }
    
    // Store submission data
    async function storeSubmissionData(submissionId, formData) {
        if (!submissionId) return false;
        
        try {
            await supabase
                .from('commday_submissions')
                .insert({
                    id: submissionId,
                    trainer_name: formData.trainerName,
                    pokemon_name: formData.pokemonName,
                    hours_played: formData.hoursPlayed,
                    start_seen: formData.startSeen,
                    start_caught: formData.startCaught,
                    end_seen: formData.endSeen,
                    end_caught: formData.endCaught,
                    shinies: formData.shinyCount,
                    created_at: new Date().toISOString()
                });
            
            return true;
        } catch (error) {
            console.error('Error storing submission data:', error);
            return false;
        }
    }
</script>
